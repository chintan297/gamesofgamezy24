<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="authoring-tool" content="Adobe_Animate_CC" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>aae_night_Html5</title>

    <!-- CreateJS -->
    <script src="./createjs.min.js"></script>
    <script src="aae_night_Html5.js"></script>

    <script>
      var mobiledevice;
      var IOS;

      function detectmob() {
        if (
          navigator.userAgent.match(/Android/i) ||
          navigator.userAgent.match(/webOS/i) ||
          navigator.userAgent.match(/iPhone/i) ||
          navigator.userAgent.match(/iPad/i) ||
          navigator.userAgent.match(/iPod/i) ||
          navigator.userAgent.match(/BlackBerry/i) ||
          navigator.userAgent.match(/Windows Phone/i)
        ) {
          mobiledevice = 1;
        } else {
          mobiledevice = 0;
        }
        IOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) ? 1 : 0;
      }

      detectmob();

      var canvas,
        stage,
        exportRoot,
        anim_container,
        dom_overlay_container,
        fnStartAnimation;
      var hlasitost = 1;

      createjs.Sound.setMute(false);

      var loadingBg = new createjs.Bitmap("images/loading/Bitmap1.png");
      var rotateBg = new createjs.Bitmap("images/loading/rotate.jpg");
      var rotateBg2 = new createjs.Bitmap("images/loading/rotate2.jpg");
      var progressBar = new createjs.Shape();

      rotateBg.scaleX = 1280 / 1024;
      rotateBg2.scaleX = rotateBg2.scaleY = 2;
      loadingBg.x = 0;
      loadingBg.y = 0;

      createjs.Sound.alternateExtensions = ["ogg"];

      function init() {
        canvas = document.getElementById("canvas");
        stage = new createjs.Stage(canvas);
        stage.addChild(loadingBg);
        stage.addChild(progressBar);

        anim_container = document.getElementById("animation_container");
        dom_overlay_container = document.getElementById(
          "dom_overlay_container"
        );

        var comp = AdobeAn.getComposition("8451E3C56F511840A2C2F6ADC89683E7");
        var lib = comp.getLibrary();
        createjs.MotionGuidePlugin.install();
        var loader = new createjs.LoadQueue(true);
        loader.installPlugin(createjs.Sound);
        loader.addEventListener("fileload", function (evt) {
          handleFileLoad(evt, comp);
        });
        loader.addEventListener("progress", handleProgress);
        loader.addEventListener("complete", function (evt) {
          handleComplete(evt, comp);
        });
        loader.loadManifest(lib.properties.manifest);

        resize();
      }

      function handleFileLoad(evt, comp) {
        var images = comp.getImages();
        if (evt && evt.item.type == "image") {
          images[evt.item.id] = evt.result;
        }
        resize();
      }

      function handleProgress(event) {
        progressBar.graphics
          .beginFill("#5dc0d9")
          .drawRect(0, 740, 1280 * event.progress, 47);
        stage.update();
      }

      function handleComplete(evt, comp) {
        var lib = comp.getLibrary();
        var ss = comp.getSpriteSheet();
        var queue = evt.target;
        var ssMetadata = lib.ssMetadata;

        for (i = 0; i < ssMetadata.length; i++) {
          ss[ssMetadata[i].name] = new createjs.SpriteSheet({
            images: [queue.getResult(ssMetadata[i].name)],
            frames: ssMetadata[i].frames,
          });
        }

        exportRoot = new lib.aae_night_Html5();
        stage = new lib.Stage(canvas);
        stage.enableMouseOver();

        fnStartAnimation = function () {
          stage.addChild(exportRoot);
          createjs.Ticker.setFPS(lib.properties.fps);
          createjs.Ticker.addEventListener("tick", stage);
        };

        AdobeAn.compositionLoaded(lib.properties.id);
        createjs.Touch.enable(stage);
        fnStartAnimation();
        resize();

        window.addEventListener("resize", doubleResize);
      }

      function playSound(id, loop) {
        return createjs.Sound.play(
          id,
          createjs.Sound.INTERRUPT_EARLY,
          0,
          0,
          loop
        );
      }

      function resize() {
        if (
          (window.innerHeight < window.innerWidth &&
            navigator.userAgent.match("Mac OS")) ||
          (screen.width == 720 &&
            screen.height == 1280 &&
            window.innerHeight < window.innerWidth &&
            navigator.userAgent.match("Android")) ||
          (screen.width != 720 &&
            screen.height != 1280 &&
            screen.height < screen.width &&
            navigator.userAgent.match("Android")) ||
          (window.innerHeight < window.innerWidth &&
            navigator.userAgent.match(/BlackBerry/i)) ||
          (window.innerHeight < window.innerWidth &&
            navigator.userAgent.match(/Windows Phone/i)) ||
          !mobiledevice
        ) {
          window.scrollTo(0, 0);
          stage.removeChild(rotateBg);
          stage.removeChild(rotateBg2);

          var GAME_WIDTH = 1280;
          var GAME_HEIGHT = 1024;
          var width = window.innerWidth || document.body.clientWidth;
          var height = window.innerHeight || document.body.clientHeight;
          var ratio = document.body.clientWidth / 1280;

          var top_style = 50;
          if (IOS && width / height > 2.1) top_style = 47;

          canvas.style.height =
            dom_overlay_container.style.height =
            anim_container.style.height =
              GAME_HEIGHT * ratio + "px";
          canvas.style.width =
            dom_overlay_container.style.width =
            anim_container.style.width =
              GAME_WIDTH * ratio + "px";

          canvas.style.position = "absolute";
          canvas.style.left = "50%";
          canvas.style.top = top_style + "%";
          canvas.style.transform = "translate3d( -50%, -50%, 0 )";

          dom_overlay_container.style.position = "absolute";
          dom_overlay_container.style.left = "50%";
          dom_overlay_container.style.top = top_style + "%";
          dom_overlay_container.style.transform =
            "translate3d( -50%, -50%, 0 )";

          anim_container.style.position = "fixed";
          anim_container.style.left = "50%";
          anim_container.style.top = top_style + "%";
          anim_container.style.transform = "translate3d( -50%, -50%, 0 )";

          return top_style;
        } else {
          window.scrollTo(0, 0);
          stage.addChild(rotateBg);
          stage.addChild(rotateBg2);

          var GAME_WIDTH = 1280;
          var GAME_HEIGHT = 1024;
          var ratio = document.body.clientWidth / 1280;

          canvas.style.height =
            dom_overlay_container.style.height =
            anim_container.style.height =
              GAME_HEIGHT * ratio + "px";
          canvas.style.width =
            dom_overlay_container.style.width =
            anim_container.style.width =
              GAME_WIDTH * ratio + "px";

          canvas.style.position = "absolute";
          canvas.style.left = "50%";
          canvas.style.top = "50%";
          canvas.style.transform = "translate3d( -50%, -50%, 0 )";

          dom_overlay_container.style.position = "absolute";
          dom_overlay_container.style.left = "50%";
          dom_overlay_container.style.top = "50%";
          dom_overlay_container.style.transform =
            "translate3d( -50%, -50%, 0 )";

          anim_container.style.position = "fixed";
          anim_container.style.left = "50%";
          anim_container.style.top = "50%";
          anim_container.style.transform = "translate3d( -50%, -50%, 0 )";

          rotateBg2.x = 1280 / 2 - rotateBg2.getBounds().width;
          rotateBg2.y = 1024 / 2 - rotateBg2.getBounds().height;
        }
      }

      function doubleResize() {
        resize();
        setTimeout(function () {
          resize();
        }, 500);
      }
    </script>
  </head>

  <body onload="init();" style="margin: 0px" onresize="doubleResize();">
    <div
      id="animation_container"
      style="background-color: rgba(1, 1, 1, 1); width: 1280px; height: 1024px"
    >
      <canvas
        id="canvas"
        width="1280"
        height="1024"
        style="
          position: absolute;
          display: block;
          background-color: rgba(256, 256, 256, 1);
        "
      ></canvas>
      <div
        id="dom_overlay_container"
        style="
          pointer-events: none;
          overflow: hidden;
          width: 1280px;
          height: 1024px;
          position: absolute;
          left: 0px;
          top: 0px;
          display: block;
        "
      ></div>
    </div>
  </body>
</html>
